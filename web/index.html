<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>p2pfs Web UI</title>
</head>
<body>
    <h1>p2pfs Web Interface</h1>
    <div id="app">
        <h2>Add File</h2>
        <input type="file" id="fileInput" />
        <button id="addBtn">Add</button>
        <p id="cidResult"></p>
        <h2>Cat File</h2>
        <input type="text" id="cidInput" placeholder="CID" />
        <button id="catBtn">Cat</button>
        <pre id="catResult"></pre>
        <h2>Connect Peer</h2>
        <input type="text" id="addrInput" placeholder="Multiaddr" />
        <button id="connectBtn">Connect</button>
        <p id="connectResult"></p>

        <h2>Fetch Block from Peer</h2>
        <input type="text" id="fetchCidInput" placeholder="CID" />
        <button id="fetchBtn">Fetch</button>
        <pre id="fetchResult"></pre>

        <h2>List Links</h2>
        <input type="text" id="lsCidInput" placeholder="CID" />
        <button id="lsBtn">LS</button>
        <pre id="lsResult"></pre>
    </div>
    <script>
        document.getElementById('addBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const form = new FormData();
            form.append('file', file);
            const res = await fetch('/api/add', { method: 'POST', body: form });
            const data = await res.json();
            document.getElementById('cidResult').innerText = 'CID: ' + data.cid;
        });

        document.getElementById('catBtn').addEventListener('click', async () => {
            const cid = document.getElementById('cidInput').value;
            const res = await fetch('/api/cat?cid=' + cid);
            const text = await res.text();
            document.getElementById('catResult').innerText = text;
        });

        document.getElementById('lsBtn').addEventListener('click', async () => {
            try {
                const cid = document.getElementById('lsCidInput').value;
                const res = await fetch('/api/ls?cid=' + cid);
                if (!res.ok) {
                    const errText = await res.text();
                    throw new Error(errText);
                }
                const data = await res.json();
                document.getElementById('lsResult').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                document.getElementById('lsResult').innerText = 'Error: ' + err.message;
                console.error(err);
            }
        });
    </script>
</body>
</html>
